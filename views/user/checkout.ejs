<style>
    ::placeholder {
        color: red;
        opacity: 1;
        /* Firefox */
    }
</style>

<%- include('../partials/header.ejs') %>



<section class="section register min-vh-100 d-flex flex-column align-items-center justify-content-center py-4 "
    id="product">
    <div class="container ">
        <div class="row justify-content-center ">
            <div class="col-lg-7 col-md-6 d-flex flex-column align-items-center justify-content-center">

                <div class="card mb-8">




                    <!-- Card with an image on left -->


                    <div class="row g-0"><% if (user.default_address) { %>
                        <% const address=user.default_address %>
                        <div class="address-container d-flex align-items-center">
                            <div class="card-title px-3 pb-0 "><%= address.address_cust_name %></div>
                            <div id="total" class="col text-right">
                                <%= address.address_type %>
                            </div>
                        </div>

                        <div class="address-container d-flex align-items-center">
                            <div class="col label ">
                                <p class="text-normal">
                                    <%= address.house_name %>(H),
                                    <%= address.locality %>,
                                    <%= address.area_street %>,
                                    <%= address.landmark %>,
                                    <%= address.city %>,

                                    <%= address.state %>
                                    <span class="fw-bold">
                                        -<%= address.pincode %>
                                    </span>
                                </p>
                            </div>

                        </div>
                        <div class="address-container d-flex align-items-center">
                            <div class="col label ">
                                <p>
                                    mobile:<%= address.phone %></p>
                            </div>
                        </div>
                        <% } %>

                        <div class="address-container d-flex align-items-center">
                            <div id="total" class="col text-right">
                                <button type="button" data-modal-target="authentication-modal"
                                    data-modal-toggle="authentication-modal"
                                    class="py-2.5 px-4 me-2 mb-2 text-sm font-medium text-gray-900 focus:outline-none bg-white rounded-lg border border-gray-200 hover:bg-gray-100 hover:text-blue-700 focus:z-10 focus:ring-4 focus:ring-gray-100 dark:focus:ring-gray-700 dark:bg-gray-800 dark:text-gray-400 dark:border-gray-600 dark:hover:text-white dark:hover:bg-gray-700">Edit/Change</button>
                                <button type="button"
                                    class="py-2.5 px-4 me-2 mb-2 text-sm font-medium text-gray-900 focus:outline-none bg-white rounded-lg border border-gray-200 hover:bg-gray-100 hover:text-blue-700 focus:z-10 focus:ring-4 focus:ring-gray-100 dark:focus:ring-gray-700 dark:bg-gray-800 dark:text-gray-400 dark:border-gray-600 dark:hover:text-white dark:hover:bg-gray-700"><a
                                        href="/add-address">Add new Address</a></button>
                                <!-- Main modal -->
                                <div id="authentication-modal" tabindex="-1" aria-hidden="true"
                                    class="hidden overflow-y-auto overflow-x-hidden fixed top-0 right-0 left-0 z-50 justify-center items-center w-full md:inset-0 h-[calc(100%-1rem)] max-h-full">
                                    <div class="relative p-4 w-full max-w-lg  mt-10">
                                        <!-- Modal content -->
                                        <div class="relative bg-white rounded-lg shadow dark:bg-gray-700">
                                            <!-- Modal header -->
                                            <div
                                                class="flex items-center justify-between p-4 md:p-5 border-b rounded-t dark:border-gray-600">
                                                <h3 class="text-xl font-semibold text-gray-900">
                                                    Change Address
                                                </h3>
                                                <button type="button"
                                                    class="end-2.5 text-gray-400 bg-transparent hover:bg-gray-200 hover:text-gray-900 rounded-lg text-sm w-8 h-8 ms-auto inline-flex justify-center items-center dark:hover:bg-gray-600 dark:hover:text-white"
                                                    data-modal-hide="authentication-modal">
                                                    <svg class="w-3 h-3" aria-hidden="true"
                                                        xmlns="http://www.w3.org/2000/svg" fill="none"
                                                        viewBox="0 0 14 14">
                                                        <path stroke="currentColor" stroke-linecap="round"
                                                            stroke-linejoin="round" stroke-width="2"
                                                            d="m1 1 6 6m0 0 6 6M7 7l6-6M7 7l-6 6" />
                                                    </svg>
                                                    <span class="sr-only">Close modal</span>
                                                </button>
                                            </div>
                                            <!-- Modal body -->
                                            <div class="p-4 md:p-5">
                                                <form class="space-y-4" id="form">
                                                    <% addresses.forEach(add=> { %>

                                                    <!-- Card with an image on left -->
                                                    <div class="card">
                                                        <div class="row ">
                                                            <div class="col-1">

                                                                <div>
                                                                    <input id="addressInput" type="radio" name="address"
                                                                        value="<%= add._id %>"
                                                                        onchange="select_address(this)"
                                                                        name="flexRadioDefault" required />
                                                                </div>
                                                            </div>
                                                            <div class="col">
                                                                <div
                                                                    class="address-container d-flex align-items-center">
                                                                    <div class="card-title  p-0 ">
                                                                        <%= add.address_cust_name %></div>
                                                                    <div id="total" class="col text-right">
                                                                        <%= add.address_type %>
                                                                    </div>
                                                                </div>


                                                                <div class="address-container d-flex align-items-left">
                                                                    <div class="col label pl-0">
                                                                        <p class="text-left">
                                                                            <%= add.house_name %>(H),
                                                                            <%= add.locality %>,
                                                                            <%= add.area_street %>,
                                                                            <%= add.landmark %>,
                                                                            <%= add.city %>,
                                                                            <%= add.state %>
                                                                            <span class="fw-bold">
                                                                                -<%= add.pincode %>
                                                                            </span>
                                                                        </p>
                                                                    </div>
                                                                </div>

                                                                <div
                                                                    class="address-container d-flex align-items-center pb-4">
                                                                    <div class="col label pl-0 text-left ">
                                                                        <p> mobile:<%= add.phone %></p>
                                                                        <div class="col text-right">

                                                                            <button type="button"
                                                                                data-modal-target="authentication-modal"
                                                                                data-modal-toggle="authentication-modal"
                                                                                type="button"
                                                                                class="text-purple-700 hover:text-purple-700 border border-purple-700 hover:bg-purple-300 focus:ring-4 focus:outline-none focus:ring-purple-300 font-medium rounded-lg text-sm px-3 py-2 text-center me-2 mb-2 "
                                                                                onclick="editAddress(this)">Edit</button>






                                                                            <button type="button"
                                                                                class="text-purple-700 hover:text-purple-700 border border-purple-700 hover:bg-purple-300 focus:ring-4 focus:outline-none focus:ring-purple-300 font-medium rounded-lg text-sm px-3 py-2 text-center me-2 mb-2 "
                                                                                onclick="removeAddress(this)"
                                                                                data-address-id="<%= add._id %>">Remove</button>
                                                                        </div>
                                                                    </div>
                                                                </div>

                                                            </div>
                                                            <!-- <hr /> -->
                                                        </div>
                                                    </div>
                                                    <!-- End Card with an image on left -->
                                                    <% }); %>
                                                </form>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>


                    </div>
                    <!-- <hr /> -->

                    <!-- End Card with an image on left -->






                    <div class="card-body">

                        <% cartItems.forEach(product=> { %>

                        <!-- Card with an image on left -->
                        <div class="card m-3">
                            <div class="row g-0">
                                <div class="col-md-3" style="width: 16%;">
                                    <img src="/files/<%= product.product_id.img1 %>" class="img-fluid rounded-start"
                                        alt="...">
                                </div>
                                <div class="col-md-9">
                                    <div class="card-body">
                                        <h5 class="card-title pb-0 pt-2">
                                            <%= product.product_id.product_name %>
                                        </h5>
                                        <p class="card-text">
                                            <%= product.product_id.description.split(' ').slice(0,
                                                                15).join(' ') %>
                                        </p>

                                    </div>
                                </div>
                            </div>
                        </div><!-- End Card with an image on left -->
                        <% }); %>

                        <form class="row g-3 needs-validation" novalidate>
                            <!-- <div class="col-12">
                                <label for="input-group-1" class="block mb-2 text-sm font-medium text-gray-900 dark:text-white"></label>
                                <div class="relative mb-6">
                                    <div class="absolute inset-y-0 start-0 flex items-center ps-3.5 pointer-events-none">
                                        <i class="fa fa-gift" aria-hidden="true"></i>
                                    </div>
                                    <input type="text" id="input-group-1"
                                        class="bg-purple-50 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full ps-10 p-2.5   "
                                        placeholder="Apply Promo Code">
                                </div>
                             </div> -->
                            <div div class="col-12">
                                <div class="card-body">
                                    <div class="tab-content">

                                        <div class="tab-pane fade show active profile-overview" id="profile-overview">
                                            <h5 class="card-title pb-0">
                                                Price Details
                                            </h5>

                                            <div class="row">
                                                <div class="col label ">Order Total</div>
                                                <div id="total" class="col text-right">
                                                    <b>₹<%= totalPrice %> </b>
                                                </div>
                                            </div>
                                            <div class="row pb-2">
                                                <div class="col label ">Shipping Charges</div>
                                                <div class="col text-right">
                                                    <% if (shipping===0) { %>
                                                    Free
                                                    <% } else { %>
                                                    ₹ 60
                                                    <% } %> </div>
                                            </div>
                                        </div>
                                        <!-- <div class="row pb-2">
                                    <div class="col label ">Coupon Discount</div>
                                    <div class="col text-right">
                                        yrtyrtyrty </div>
                                </div> -->
                                        <div class="row border-top pt-2">
                                            <div class="col label ">Order Total</div>
                                            <div id="total" class="col text-right">
                                                <b>₹<%= totalPrice + shipping %> </b> </div>
                                        </div>


                                    </div>
                                </div>

                            </div>

                    </div>



                    <div class="col-12">
                        <button
                            class="btn  w-100 text-gray-900 p-2.5 relative inline-flex items-center justify-center overflow-hidden  text-gray-900 rounded-lg group bg-gradient-to-br from-purple-50 to-pink-300 group-hover:from-purple-50 group-hover:to-pink-50 hover:text-pink-500 dark:text-white focus:ring-4 focus:outline-none focus:ring-purple-200 dark:focus:ring-purple-800"
                            type="submit">
                            <a href="/checkout/payment"> Ship to this Address</a></button>
                    </div>
                    <div class="col-12">
                        <!-- <p class="small mb-0">Already have an account? <a href="pages-login.html">Log
                                            in</a>
                                    </p> -->
                    </div>
                    </form>
                </div>
            </div>
        </div>


    </div>
    </div>
    </div>

</section>

</div>

<a href="#" class="back-to-top d-flex align-items-center justify-content-center"><i
        class="bi bi-arrow-up-short"></i></a>


<script>
    /**
     * @param {HTMLSelectElement} element
     */
    // const quantity = async (element) => {
    //     // console.log("element", element.value);
    //     const id = element.getAttribute('data-product-id'); // Accessing the data attribute const
    //     const qty = element.value;
    //     const price=document.getElementById(id);
    //     const total=document.getElementById('total')

    //     console.log("qty", qty); 
    //     try {
    //         const res = await axios.post('/update-quantity', { productId: id, newQuantity: qty })
    //         const updatePrice=res.data;
    //         price.innerHTML=`<b>₹  ${updatePrice.price} </b> <del>₹${updatePrice.mrp} </del> `
    //          total.innerHTML=`<b>₹ ${updatePrice.totalPrice} </b>`

    //         console.log("price",price);
    //      }
    //          catch (error) { }
    //     } 

    const select_address = async (element) => {
        console.log("element", element.value)
        const id = element.value
        try {
            const res = await axios.post('/choose-address', {
                id
            })
            if (res.status === 200) {
                window.location.reload()
            }
        } catch (error) {
            console.log("error", error);
        }
    }

    const removeAddress = async (element) => {
        const id = element.getAttribute('data-address-id'); // Accessing the data attribute const
        console.log("addressid", id);
        try {
            const res = await axios.delete(`/remove-address/${id}`)
            if (res.status === 200) {
                window.location.reload()
            }
        } catch (error) {

        }
    }
</script>